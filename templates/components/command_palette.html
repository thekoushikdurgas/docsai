{% comment %}
Command Palette Component

A keyboard-first command palette for quick navigation and actions.
Activated with Cmd/Ctrl + K.

Usage:
{% include 'components/command_palette.html' %}

The component will automatically register global keyboard shortcuts.
{% endcomment %}

{% load static %}

<div id="command-palette" class="command-palette fixed inset-0 z-[200] hidden" role="dialog" aria-modal="true" aria-labelledby="command-palette-title">
    <!-- Backdrop -->
    <div class="command-palette-backdrop fixed inset-0 bg-gray-900/60 dark:bg-gray-900/80 backdrop-blur-sm" onclick="closeCommandPalette()"></div>
    
    <!-- Dialog -->
    <div class="command-palette-dialog fixed top-[20%] left-1/2 -translate-x-1/2 w-full max-w-[var(--command-palette-max-width)] mx-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden">
            <!-- Search Input -->
            <div class="border-b border-gray-200 dark:border-gray-700 p-4">
                <div class="flex items-center gap-3">
                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <input 
                        type="text" 
                        id="command-palette-input"
                        class="flex-1 bg-transparent border-none outline-none text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 text-base"
                        placeholder="Type a command or search..."
                        autocomplete="off"
                        oninput="filterCommands(this.value)"
                    />
                    <kbd class="hidden sm:inline-block px-2 py-1 text-xs font-semibold text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 rounded">ESC</kbd>
                </div>
            </div>
            
            <!-- Results -->
            <div id="command-palette-results" class="max-h-[var(--command-palette-max-height)] overflow-y-auto p-2">
                <!-- Quick Actions -->
                <div class="command-group">
                    <div class="px-3 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">Quick Actions</div>
                    <div class="space-y-1" id="quick-actions">
                        <button type="button" class="command-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-command="new-page" onclick="executeCommand('new-page')">
                            <span class="w-8 h-8 flex items-center justify-center bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                                <svg class="w-4 h-4 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                            </span>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-900 dark:text-gray-100">New Page</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Create a new documentation page</div>
                            </div>
                            <kbd class="px-2 py-1 text-xs text-gray-400 bg-gray-100 dark:bg-gray-700 rounded">Ctrl+N</kbd>
                        </button>
                        
                        <button type="button" class="command-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-command="new-workflow" onclick="executeCommand('new-workflow')">
                            <span class="w-8 h-8 flex items-center justify-center bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                                <svg class="w-4 h-4 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6z"></path>
                                </svg>
                            </span>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-900 dark:text-gray-100">New Workflow</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Create a new automation workflow</div>
                            </div>
                        </button>
                        
                        <button type="button" class="command-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-command="ai-chat" onclick="executeCommand('ai-chat')">
                            <span class="w-8 h-8 flex items-center justify-center bg-green-100 dark:bg-green-900/30 rounded-lg">
                                <svg class="w-4 h-4 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                                </svg>
                            </span>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-900 dark:text-gray-100">AI Assistant</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">Open AI chat assistant</div>
                            </div>
                            <kbd class="px-2 py-1 text-xs text-gray-400 bg-gray-100 dark:bg-gray-700 rounded">Ctrl+K</kbd>
                        </button>
                    </div>
                </div>
                
                <!-- Navigation -->
                <div class="command-group mt-4">
                    <div class="px-3 py-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">Navigation</div>
                    <div class="space-y-1" id="navigation-items">
                        <button type="button" class="command-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-command="nav-dashboard" onclick="executeCommand('nav-dashboard')">
                            <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                            </svg>
                            <span class="text-sm text-gray-700 dark:text-gray-300">Dashboard</span>
                        </button>
                        
                        <button type="button" class="command-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-command="nav-docs" onclick="executeCommand('nav-docs')">
                            <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span class="text-sm text-gray-700 dark:text-gray-300">Documentation</span>
                        </button>
                        
                        <button type="button" class="command-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-command="nav-workflows" onclick="executeCommand('nav-workflows')">
                            <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5z"></path>
                            </svg>
                            <span class="text-sm text-gray-700 dark:text-gray-300">Workflows</span>
                        </button>
                        
                        <button type="button" class="command-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors" data-command="nav-tasks" onclick="executeCommand('nav-tasks')">
                            <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                            </svg>
                            <span class="text-sm text-gray-700 dark:text-gray-300">Tasks</span>
                        </button>
                    </div>
                </div>
                
                <!-- No Results -->
                <div id="no-results" class="hidden py-8 text-center">
                    <svg class="w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <p class="text-gray-500 dark:text-gray-400">No results found</p>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-3 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                <div class="flex items-center gap-4">
                    <span class="flex items-center gap-1">
                        <kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">↑</kbd>
                        <kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">↓</kbd>
                        to navigate
                    </span>
                    <span class="flex items-center gap-1">
                        <kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">↵</kbd>
                        to select
                    </span>
                </div>
                <span>Powered by DocsAI</span>
            </div>
        </div>
    </div>
</div>

<script>
// Command Palette Controller
(function() {
    const palette = document.getElementById('command-palette');
    const input = document.getElementById('command-palette-input');
    let selectedIndex = 0;
    
    // Open with Cmd/Ctrl + K
    document.addEventListener('keydown', function(e) {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
            e.preventDefault();
            openCommandPalette();
        }
    });
    
    window.openCommandPalette = function() {
        palette.classList.remove('hidden');
        input.value = '';
        input.focus();
        filterCommands('');
        selectedIndex = 0;
        updateSelection();
    };
    
    window.closeCommandPalette = function() {
        palette.classList.add('hidden');
    };
    
    // Keyboard navigation
    palette.addEventListener('keydown', function(e) {
        const items = palette.querySelectorAll('.command-item:not(.hidden)');
        
        if (e.key === 'Escape') {
            closeCommandPalette();
        } else if (e.key === 'ArrowDown') {
            e.preventDefault();
            selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
            updateSelection();
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            selectedIndex = Math.max(selectedIndex - 1, 0);
            updateSelection();
        } else if (e.key === 'Enter') {
            e.preventDefault();
            items[selectedIndex]?.click();
        }
    });
    
    function updateSelection() {
        const items = palette.querySelectorAll('.command-item:not(.hidden)');
        items.forEach((item, index) => {
            if (index === selectedIndex) {
                item.classList.add('bg-gray-100', 'dark:bg-gray-700');
                item.scrollIntoView({ block: 'nearest' });
            } else {
                item.classList.remove('bg-gray-100', 'dark:bg-gray-700');
            }
        });
    }
    
    window.filterCommands = function(query) {
        const items = palette.querySelectorAll('.command-item');
        const noResults = document.getElementById('no-results');
        let visibleCount = 0;
        
        query = query.toLowerCase();
        
        items.forEach(item => {
            const text = item.textContent.toLowerCase();
            if (query === '' || text.includes(query)) {
                item.classList.remove('hidden');
                visibleCount++;
            } else {
                item.classList.add('hidden');
            }
        });
        
        noResults.classList.toggle('hidden', visibleCount > 0);
        
        // Hide empty groups
        palette.querySelectorAll('.command-group').forEach(group => {
            const visibleItems = group.querySelectorAll('.command-item:not(.hidden)').length;
            group.classList.toggle('hidden', visibleItems === 0);
        });
        
        selectedIndex = 0;
        updateSelection();
    };
    
    window.executeCommand = function(command) {
        closeCommandPalette();
        
        const commands = {
            'new-page': () => window.location.href = '/docs/page/create/',
            'new-workflow': () => window.location.href = '/durgasflow/editor/new/',
            'ai-chat': () => window.location.href = '/ai/chat/',
            'nav-dashboard': () => window.location.href = '/',
            'nav-docs': () => window.location.href = '/docs/',
            'nav-workflows': () => window.location.href = '/durgasflow/',
            'nav-tasks': () => window.location.href = '/tasks/',
        };
        
        if (commands[command]) {
            commands[command]();
        }
    };
})();
</script>
