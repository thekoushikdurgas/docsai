{% extends "base.html" %}
{% load static %}

{% block title %}Routes & APIs Overview | DocsAI{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-5xl">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">{{ page_title|default:"Routes & APIs Overview" }}</h1>
        <p class="text-gray-600 dark:text-gray-400">{{ page_description|default:"High-level structure of web routes and REST API endpoints in contact360/docsai." }}</p>
    </div>

    <div class="space-y-8">
        <!-- 1. High-level structure -->
        <section class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">1. High-level structure</h2>
            <ul class="list-disc list-inside space-y-2 text-gray-700 dark:text-gray-300 text-sm">
                <li><strong>Root</strong> is <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">docsai/urls.py</code>. It mounts:</li>
                <li>One <strong>REST API</strong> prefix: <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">api/v1/</code> → documentation API.</li>
                <li><strong>OpenAPI/schema</strong> and docs UI under <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">api/</code> (schema, docs, swagger, redoc).</li>
                <li>All <strong>web (HTML)</strong> apps under their own prefixes (e.g. <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">docs/</code>, <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">durgasman/</code>, <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">ai/</code>).</li>
                <li><code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">apps/api/urls.py</code> (central API gateway) is <strong>not</strong> included at root; only <code class="bg-gray-100 dark:bg-gray-700 px-1 rounded">api/v1/</code> is mounted.</li>
            </ul>
        </section>

        <!-- 2. REST API routes -->
        <section class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">2. REST API routes (under /api/)</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-left text-gray-700 dark:text-gray-300">
                    <thead class="text-xs uppercase bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white">
                        <tr>
                            <th class="px-4 py-2">Prefix</th>
                            <th class="px-4 py-2">Description</th>
                            <th class="px-4 py-2">Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/api/v1/</code></td><td>Documentation REST API (health, docs meta, pages, endpoints, relationships, postman, dashboard)</td><td>~111</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/api/schema/</code></td><td>OpenAPI schema (drf-spectacular)</td><td>1</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/api/docs/</code></td><td>API docs index (custom)</td><td>1</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/api/swagger/</code></td><td>Swagger UI</td><td>1</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/api/redoc/</code></td><td>ReDoc UI</td><td>1</td></tr>
                    </tbody>
                </table>
            </div>
            <p class="mt-3 text-xs text-gray-500 dark:text-gray-400">/api/v1/ breakdown: Health &amp; info (7), Pages (20), Endpoints (28), Relationships (38), Postman (14), Dashboard (4).</p>
        </section>

        <!-- 3. Web routes by app -->
        <section class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">3. Web routes (by app prefix)</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm text-left text-gray-700 dark:text-gray-300">
                    <thead class="text-xs uppercase bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white">
                        <tr>
                            <th class="px-4 py-2">Prefix</th>
                            <th class="px-4 py-2">App</th>
                            <th class="px-4 py-2">Summary</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/</code></td><td>core</td><td>Dashboard, login, register, logout</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/docs/</code></td><td>documentation</td><td>Dashboard, pages, endpoints, relationships, health, statistics, operations, media, CRUD</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/durgasman/</code></td><td>durgasman</td><td>Dashboard, collection, import, 8 api/… JSON endpoints</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/analytics/</code></td><td>analytics</td><td>Dashboard</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/ai/</code></td><td>ai_agent</td><td>Chat, sessions, api/chat</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/codebase/</code></td><td>codebase</td><td>Dashboard, scan, analyses</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/tasks/</code></td><td>tasks</td><td>List, create, detail, start, complete, edit</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/media/</code></td><td>media</td><td>List</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/graph/</code></td><td>graph</td><td>Visualization</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/tests/</code></td><td>test_runner</td><td>Dashboard</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/accessibility/</code></td><td>accessibility</td><td>Dashboard</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/roadmap/</code></td><td>roadmap</td><td>Dashboard</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/postman/</code></td><td>postman</td><td>Homepage, dashboard</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/templates/</code></td><td>templates</td><td>List</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/architecture/</code></td><td>architecture</td><td>Blueprint</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/database/</code></td><td>database</td><td>Schema</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/json-store/</code></td><td>json_store</td><td>List</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/operations/</code></td><td>operations</td><td>Dashboard</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/page-builder/</code></td><td>page_builder</td><td>Editor</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/knowledge/</code></td><td>knowledge</td><td>List, create, detail, edit, delete, search</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/admin/</code></td><td>admin</td><td>Users, history, statistics, logs, system status, settings</td></tr>
                        <tr class="border-b border-gray-200 dark:border-gray-600"><td class="px-4 py-2"><code>/durgasflow/</code></td><td>durgasflow</td><td>Workflows, editor, executions, credentials, templates, webhook</td></tr>
                    </tbody>
                </table>
            </div>
            <p class="mt-3 text-xs text-gray-500 dark:text-gray-400">20 app prefixes total. AJAX/API-like endpoints also exist under web prefixes (e.g. /docs/api/…, /durgasman/api/…).</p>
        </section>

        <!-- 4. Counts -->
        <section class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">4. Counts (approximate)</h2>
            <ul class="space-y-2 text-gray-700 dark:text-gray-300 text-sm">
                <li><strong>REST API</strong> (under /api/): ~111 under /api/v1/, 4 under /api/ (schema, docs, swagger, redoc) → ~115 total mounted.</li>
                <li><strong>Web routes</strong>: 20 app prefixes; hundreds of paths (mostly in documentation and durgasflow).</li>
                <li><strong>Not mounted</strong>: apps.api.urls (v2, ai, knowledge, tasks, durgasflow under a single /api/ gateway) is not included in root.</li>
            </ul>
        </section>

        <!-- Quick links -->
        <section class="bg-gray-50 dark:bg-gray-800/50 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-lg font-bold text-gray-900 dark:text-white mb-3">Quick links</h2>
            <div class="flex flex-wrap gap-3">
                <a href="{% url 'documentation:dashboard' %}" class="inline-flex items-center px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600">Documentation Dashboard</a>
                <a href="/api/docs/" class="inline-flex items-center px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-600 text-gray-900 dark:text-white text-sm font-medium hover:bg-gray-300 dark:hover:bg-gray-500">API Docs</a>
                <a href="/api/v1/" class="inline-flex items-center px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-600 text-gray-900 dark:text-white text-sm font-medium hover:bg-gray-300 dark:hover:bg-gray-500">API v1 Root</a>
            </div>
        </section>
    </div>
</div>
{% endblock %}
