{% extends 'base.html' %}
{% load static %}
{# Dashboard View Layout: override dashboard_header, dashboard_actions, dashboard_stats, dashboard_content. Context: page_title, page_description, stats, tabs, active_tab. #}

{% block content %}
<div class="w-full">
    <!-- Header -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-md dark:shadow-lg border border-gray-200 dark:border-gray-700 p-8">
        {% block dashboard_header %}
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-black text-gray-900 dark:text-gray-100 tracking-tight">{{ page_title|default:'Dashboard' }}</h1>
                {% if page_description %}
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">{{ page_description }}</p>
                {% endif %}
            </div>
            <div class="flex items-center gap-3">
                {% block dashboard_actions %}{% endblock %}
            </div>
        </div>
        {% endblock %}
    </div>
    
    <!-- Statistics Section (Collapsible) -->
    {% if stats %}
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md dark:shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
        <button type="button" 
                onclick="toggleStats()"
                class="w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-900/50 transition-colors"
                aria-expanded="true"
                aria-controls="stats-content">
            <h2 class="text-lg font-bold text-gray-900 dark:text-gray-100">Statistics</h2>
            <svg id="stats-chevron" class="w-5 h-5 text-gray-500 dark:text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
        </button>
        <div id="stats-content" class="px-6 pb-6">
            {% block dashboard_stats %}{% endblock %}
        </div>
    </div>
    {% endif %}
    
    <!-- Tab Navigation -->
    {% if tabs %}
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md dark:shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="border-b border-gray-200 dark:border-gray-700 px-6">
            <nav class="flex flex-wrap gap-1 -mb-px" role="tablist">
                {% for tab in tabs %}
                <a href="?tab={{ tab.id }}" 
                   class="tab-button group {% if tab.active or active_tab == tab.id %}active{% endif %}" 
                   data-tab="{{ tab.id }}" 
                   role="tab"
                   aria-selected="{% if tab.active or active_tab == tab.id %}true{% else %}false{% endif %}">
                    {% if tab.icon %}
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <use href="#icon-{{ tab.icon }}"></use>
                    </svg>
                    {% endif %}
                    <span>{{ tab.label }}</span>
                    {% if tab.badge %}
                    <span class="ml-1.5 px-1.5 py-0.5 text-xs bg-green-100 dark:bg-green-900/50 text-green-600 dark:text-green-400 rounded-full">{{ tab.badge }}</span>
                    {% endif %}
                </a>
                {% endfor %}
            </nav>
        </div>
        
        <!-- Tab Content -->
        <div class="p-6">
            {% block dashboard_content %}{% endblock %}
        </div>
    </div>
    {% else %}
        <!-- Content without tabs -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md dark:shadow-lg border border-gray-200 dark:border-gray-700 p-6">
            {% block dashboard_content %}{% endblock %}
        </div>
    {% endif %}
</div>

<script>
function toggleStats() {
    const content = document.getElementById('stats-content');
    const chevron = document.getElementById('stats-chevron');
    const button = chevron.closest('button');
    
    if (content.style.display === 'none') {
        content.style.display = 'block';
        chevron.classList.remove('rotate-180');
        button.setAttribute('aria-expanded', 'true');
    } else {
        content.style.display = 'none';
        chevron.classList.add('rotate-180');
        button.setAttribute('aria-expanded', 'false');
    }
}
</script>
{% endblock %}
